<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Payment - Heaven Furniture</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>

body {
    background: url("banner 2/bg.png") no-repeat fixed center;
    background-size: cover;
    margin: 0;
    font-family: 'Prompt', 'Tahoma', sans-serif;
    color: #333;
}

.wrapper {
    max-width: 1600px;
    margin: 0 auto;
    text-align: center;
}

.top-banner {
    border-radius: 28px;
    display: block;
    margin: 20px auto;
    transition: transform .3s ease, box-shadow .3s ease;
}
.top-banner:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 20px rgba(0,0,0,.25);
}

.nav-menu { margin: 0 auto; }
.nav-menu img {
    border-radius: 18px;
    transition: transform .25s ease, box-shadow .25s ease;
}
.nav-menu img:hover {
    transform: translateY(-6px);
    box-shadow: 0 6px 10px rgba(0,0,0,.25);
}

.payment-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 30px;
    max-width: 1200px;
    margin: 40px auto;
    padding-bottom: 50px;
}

.order-summary {
    background: white;
    padding: 30px;
    border-radius: 20px;
    width: 400px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: center;
    position: sticky;
    top: 20px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
}

.order-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 15px;
    color: #444;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 10px;
    flex-shrink: 0;
}

.order-items-scroll {
    overflow-y: auto;
    flex-grow: 1;
    padding-right: 5px;
    margin-bottom: 15px;
}

.item-row {
    display: flex;
    align-items: center;
    gap: 15px;
    background: #f9f9f9;
    padding: 10px;
    border-radius: 12px;
    margin-bottom: 10px;
    text-align: left;
    transition: 0.3s;
}
.item-row:hover { background: #f0f0f0; }

.item-row img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
}

.item-info { flex: 1; }
.item-name { font-size: 14px; font-weight: bold; color: #333; margin-bottom: 4px; }
.item-meta { font-size: 12px; color: #777; }
.item-price { font-size: 14px; font-weight: bold; color: #b5835a; }

.btn-remove-item {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 1px solid #ff4757;
    background: white;
    color: #ff4757;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-left: 10px;
}
.btn-remove-item:hover {
    background: #ff4757;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 3px 8px rgba(255, 71, 87, 0.3);
}

.summary-footer {
    border-top: 2px solid #f0f0f0;
    padding-top: 15px;
    flex-shrink: 0;
}

.price-tag {
    font-size: 26px;
    color: #b5835a;
    font-weight: bold;
    margin-bottom: 15px;
}

.btn-cancel {
    background: #fff;
    border: 2px solid #ff4757;
    color: #ff4757;
    padding: 10px 20px;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
    width: 100%;
}
.btn-cancel:hover { background: #ff4757; color: white; }

.payment-details {
    background: white;
    padding: 40px;
    border-radius: 20px;
    flex: 1;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: left;
}

.section-header {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 15px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 10px;
}

.bank-card {
    background: linear-gradient(135deg, #138f2d 0%, #066d20 100%);
    color: white;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 10px 20px rgba(19, 143, 45, 0.4);
    position: relative;
    overflow: hidden;
    border: 1px solid #117e28;
    animation: fadeIn 0.5s;
}

@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

.bank-card h3 { margin: 0 0 10px 0; font-size: 18px; }
.bank-logo {
    position: absolute; top: 15px; right: 20px; opacity: 0.3;
    font-size: 50px; font-weight: bold; color: white; font-family: 'Tahoma', sans-serif;
}

.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
.form-control {
    width: 95%; padding: 12px 15px;
    border: 1px solid #ddd; border-radius: 10px;
    font-size: 16px; font-family: 'Prompt', sans-serif;
    transition: 0.3s; outline: none;
}
.form-control:focus {
    border-color: #b5835a; box-shadow: 0 0 0 3px rgba(181, 131, 90, 0.1);
}
textarea.form-control { resize: vertical; min-height: 80px; }

.btn-confirm {
    background: #b5835a; color: white; border: none;
    padding: 15px; width: 100%; border-radius: 12px;
    font-size: 18px; font-weight: bold; cursor: pointer;
    transition: 0.3s; margin-top: 10px;
    box-shadow: 0 5px 15px rgba(181, 131, 90, 0.4);
}
.btn-confirm:hover { background: #a0724e; transform: translateY(-2px); }

.modal-overlay {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    justify-content: center;
    align-items: center;
    font-family: 'Prompt', sans-serif;
}

.modal-box {
    background-color: #fff;
    margin: auto;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 400px;
    text-align: center;
    position: relative;
    animation: zoomIn 0.3s ease;
    border-top: 8px solid #b5835a;
}

@keyframes zoomIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.modal-icon-bounce {
    font-size: 60px;
    color: #b5835a;
    margin-bottom: 20px;
    display: block;
    animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
  40% {transform: translateY(-10px);}
  60% {transform: translateY(-5px);}
}

.modal-title { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 10px; }
.modal-text { font-size: 16px; color: #666; margin-bottom: 25px; line-height: 1.5; }

.modal-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
}

.btn-modal-cancel {
    background: #fff; border: 2px solid #ddd; color: #666;
    padding: 10px 25px; border-radius: 30px; font-weight: bold; cursor: pointer;
    transition: 0.2s; font-family: 'Prompt', sans-serif; font-size: 16px;
}
.btn-modal-cancel:hover { background: #f0f0f0; border-color: #ccc; }

.btn-modal-confirm {
    background: #b5835a; border: 2px solid #b5835a; color: white;
    padding: 10px 30px; border-radius: 30px; font-weight: bold; cursor: pointer;
    transition: 0.2s; font-family: 'Prompt', sans-serif; font-size: 16px;
    box-shadow: 0 4px 10px rgba(181, 131, 90, 0.3);
}
.btn-modal-confirm:hover { background: #a0724e; transform: translateY(-2px); }

</style>

<script type="text/javascript">
function MM_swapImgRestore() { var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc; }
function MM_preloadImages() { var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array(); var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0;i<a.length;i++) if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}} }
function MM_findObj(n,d) { var p,i,x; if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) { d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p); } if(!(x=d[n])&&d.all) x=d.all[n]; for(i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n]; for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document); if(!x&&d.getElementById) x=d.getElementById(n); return x; }
function MM_swapImage() { var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3) if ((x=MM_findObj(a[i]))!=null){ document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2]; } }
</script>

</head>

<body onLoad="MM_preloadImages('banner 2/home1.1.png','banner 2/home5.1.png','banner 2/home2.1.png','banner 2/home3.1.png','banner 2/home4.1.png','banner 2/home6/1.png','banner 2/home7/1.png','banner 2/home8/1.png','banner 2/home9/1.png')">

<div id="customConfirmModal" class="modal-overlay">
  <div class="modal-box">
    <i class="fas fa-question-circle modal-icon-bounce"></i>
    <div class="modal-title">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
    <div class="modal-text">‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô<br>‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
    
    <div class="modal-buttons">
      <button class="btn-modal-cancel" onclick="closeConfirmModal()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      <button class="btn-modal-confirm" onclick="confirmOrderProcess()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    </div>
  </div>
</div>

<div class="wrapper">

  <header>
    <img class="top-banner" src="bannerrrrrrrrrrrrrrrrrrrrrrrrr33/payment.png" width="1605" height="200" alt="Heaven Furniture">
  </header>

  <table width="1534" border="0" class="nav-menu">
    <tr>
      <td width="155"><a href="index.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Home','','banner 2/home1.1.png',1)"><img src="banner 2/home1.png" width="155" height="40" id="Home"></a></td>
      <td width="155"><a href="Search.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Search','','banner 2/home5.1.png',1)"><img src="banner 2/home5.png" width="155" height="40" id="Search"></a></td>
      <td width="155"><a href="Product.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Product','','banner 2/home2.1.png',1)"><img src="banner 2/home2.png" width="155" height="40" id="Product"></a></td>
      <td width="155"><a href="Recommended products.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Rec','','banner 2/home3.1.png',1)"><img src="banner 2/home3.png" width="155" height="40" id="Rec"></a></td>
      <td width="155"><a href="promotion.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Promo','','banner 2/home4.1.png',1)"><img src="banner 2/home4.png" width="155" height="40" id="Promo"></a></td>
      <td width="155"><a href="Contact.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Contact','','banner 2/home6/1.png',1)"><img src="banner 2/home6/2.png" width="155" height="40" id="Contact"></a></td>
      <td width="155"><a href="profile.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Profile','','banner 2/home7/1.png',1)"><img src="banner 2/home7/2.png" width="155" height="40" id="Profile"></a></td>
      <td width="155"><a href="Favorites.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Fav','','banner 2/home8/1.png',1)"><img src="banner 2/home8/2.png" width="155" height="40" id="Fav"></a></td>
      <td width="155"><a href="shopping cart.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Cart','','banner 2/home9/1.png',1)"><img src="banner 2/home9/2.png" width="155" height="40" id="Cart"></a></td>
      <td width="155"><img src="banner 2/home10/1.png" width="155" height="40"></td>
    </tr>
  </table>

  <div class="payment-container" id="mainContainer">
    
    <div class="order-summary">
      <div class="order-title">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
      
      <div id="orderItemsList" class="order-items-scroll"></div>
      
      <div class="summary-footer">
        <div style="font-size:14px; color:#888; margin-bottom:5px;">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div class="price-tag"><span id="displayPrice">0</span> THB</div>
        <button class="btn-cancel" onclick="cancelOrder()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</button>
      </div>
    </div>

    <div class="payment-details">
      
      <div class="section-header"><i class="fas fa-university"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢)</div>
      
      <div id="bankInfoSection" class="bank-card">
        <div class="bank-logo">K-BANK</div>
        <h3>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBANK)</h3>
        <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <b>HEAVEN FURNITURE</b></p>
        <p style="font-size:24px; font-weight:bold; letter-spacing:2px; margin-top:10px;">111-1-11111-1</p>
      </div>

      <div class="section-header"><i class="fas fa-file-invoice"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</div>
      <form id="payForm">
        
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
          <input type="text" id="custName" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•..." required>
        </div>

        <div class="form-group">
          <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</label>
          <textarea id="custAddress" class="form-control" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ñ‡∏ô‡∏ô, ‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•, ‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå..." required></textarea>
        </div>

        <div class="form-group">
            <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç):</label>
            <input type="tel" id="custPhone" class="form-control" placeholder="08x-xxx-xxxx" required>
        </div>

        <div class="form-group" id="slipUploadSection">
          <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</label>
          <input type="file" id="slipFile" accept="image/*" style="padding: 10px; background:#f0f0f0; width:95%; border-radius:10px;" required>
        </div>
        
        <input type="submit" class="btn-confirm" id="btnSubmit" value="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">
      </form>
    </div>

  </div>

</div>

<script>

var currentMode = "cart"; 

function loadOrderData(){
    var container = document.getElementById("orderItemsList");
    container.innerHTML = ""; 
    var totalPrice = 0;
    var trashIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`;
    
    var checkoutItem = JSON.parse(localStorage.getItem("checkoutItem"));
    
    if(checkoutItem) {
        currentMode = "single";
        let priceNum = parseInt(checkoutItem.price.toString().replace(/[^0-9]/g, ''));
        totalPrice = priceNum;
        let html = `
        <div class="item-row">
            <img src="${checkoutItem.img}">
            <div class="item-info">
                <div class="item-name">${checkoutItem.name}</div>
                <div class="item-meta">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 1 ‡∏ä‡∏¥‡πâ‡∏ô</div>
            </div>
            <div class="item-price">${priceNum.toLocaleString()} ‡∏ø</div>
            <div class="btn-remove-item" onclick="removeItem('${checkoutItem.name}')">${trashIcon}</div>
        </div>`;
        container.innerHTML = html;
    } else {
        var cart = JSON.parse(localStorage.getItem("cart") || "[]");
        if(cart.length > 0) {
            currentMode = "cart";
            cart.forEach((item) => {
                let priceNum = parseInt(item.price.toString().replace(/[^0-9]/g, ''));
                let qty = item.qty || 1;
                let itemTotal = priceNum * qty;
                totalPrice += itemTotal;
                let html = `
                <div class="item-row">
                    <img src="${item.img}">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-meta">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${qty} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                    </div>
                    <div class="item-price">${itemTotal.toLocaleString()} ‡∏ø</div>
                    <div class="btn-remove-item" onclick="removeItem('${item.name}')">${trashIcon}</div>
                </div>`;
                container.innerHTML += html;
            });
        } else {
             document.getElementById("mainContainer").innerHTML = `
                <div style="background:white; padding:50px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); margin:40px auto; width:80%; text-align:center;">
                    <h2 style="color:#555;">üõí ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h2>
                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>
                    <a href='Product.html' style="display:inline-block; margin-top:20px; padding:12px 30px; background:#b5835a; color:white; text-decoration:none; border-radius:30px; font-weight:bold;">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
                </div>`;
            return;
        }
    }
    document.getElementById("displayPrice").innerText = totalPrice.toLocaleString();
}

function removeItem(name) {
    if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö '" + name + "' ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
    if(currentMode === "single") { localStorage.removeItem("checkoutItem"); } 
    else {
        let cart = JSON.parse(localStorage.getItem("cart") || "[]");
        let newCart = cart.filter(item => item.name !== name);
        localStorage.setItem("cart", JSON.stringify(newCart));
    }
    loadOrderData();
}

function cancelOrder(){
    if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){
        localStorage.removeItem("checkoutItem");
        localStorage.removeItem("cart");
        window.location.href="index.html";
    }
}

function openConfirmModal(e) {
    e.preventDefault();

    if(document.getElementById("displayPrice").innerText == "0") return;
    
    var form = document.getElementById("payForm");
    if(!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    var modal = document.getElementById("customConfirmModal");
    modal.style.display = "flex";
}

function closeConfirmModal() {
    document.getElementById("customConfirmModal").style.display = "none";
}

function confirmOrderProcess() {
    closeConfirmModal();

    var orderItems = [];
    var total = 0;
    
    if(currentMode === "single") {
        var item = JSON.parse(localStorage.getItem("checkoutItem"));
        let priceNum = parseInt(item.price.toString().replace(/[^0-9]/g, ''));
        orderItems.push({ name: item.name, qty: 1, price: priceNum });
        total = priceNum;
    } else {
        var cart = JSON.parse(localStorage.getItem("cart") || "[]");
        cart.forEach(item => {
            let priceNum = parseInt(item.price.toString().replace(/[^0-9]/g, ''));
            let qty = item.qty || 1;
            orderItems.push({ name: item.name, qty: qty, price: priceNum * qty });
            total += (priceNum * qty);
        });
    }

    var cName = document.getElementById("custName").value;
    var cAddr = document.getElementById("custAddress").value;
    var cPhone = document.getElementById("custPhone").value;
    var fullInfo = cName + " (" + cPhone + ") " + cAddr;
    
    var receiptData = {
        orderNo: "ORD-" + Math.floor(Math.random() * 1000000), 
        customerName: fullInfo, 
        date: new Date().toLocaleDateString('th-TH'),
        paymentMethod: "‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢)",
        items: orderItems,
        totalPrice: total
    };

    localStorage.setItem("receiptData", JSON.stringify(receiptData));
    localStorage.removeItem("checkoutItem");
    localStorage.removeItem("cart");

    window.location.href = "success.html";
}

loadOrderData();

document.getElementById("payForm").onsubmit = openConfirmModal;

window.onclick = function(event) {
  var modal = document.getElementById("customConfirmModal");
  if (event.target == modal) {
    closeConfirmModal();
  }
}
</script>

</body>
</html>
